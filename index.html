<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link href="css\bootstrap.min.css" rel="stylesheet" />
    
    <script src="https://cdn.ethers.io/scripts/ethers-v4.min.js"
            charset="utf-8"
            type="text/javascript">
    </script>
</head>
<body class="container">

    <script>
        window.onload = function () {
            getvotes();
        }
        function getvotes() {
            abi = [
                {
                    "inputs": [
                        {
                            "internalType": "address",
                            "name": "to",
                            "type": "address"
                        }
                    ],
                    "name": "delegate",
                    "outputs": [],
                    "stateMutability": "nonpayable",
                    "type": "function"
                },
                {
                    "inputs": [
                        {
                            "internalType": "address",
                            "name": "voter",
                            "type": "address"
                        }
                    ],
                    "name": "giveRightToVote",
                    "outputs": [],
                    "stateMutability": "nonpayable",
                    "type": "function"
                },
                {
                    "inputs": [],
                    "stateMutability": "nonpayable",
                    "type": "constructor"
                },
                {
                    "inputs": [
                        {
                            "internalType": "uint256",
                            "name": "proposal",
                            "type": "uint256"
                        }
                    ],
                    "name": "vote",
                    "outputs": [],
                    "stateMutability": "nonpayable",
                    "type": "function"
                },
                {
                    "inputs": [],
                    "name": "chairperson",
                    "outputs": [
                        {
                            "internalType": "address",
                            "name": "",
                            "type": "address"
                        }
                    ],
                    "stateMutability": "view",
                    "type": "function"
                },
                {
                    "inputs": [
                        {
                            "internalType": "uint256",
                            "name": "",
                            "type": "uint256"
                        }
                    ],
                    "name": "proposals",
                    "outputs": [
                        {
                            "internalType": "string",
                            "name": "name",
                            "type": "string"
                        },
                        {
                            "internalType": "uint256",
                            "name": "voteCount",
                            "type": "uint256"
                        }
                    ],
                    "stateMutability": "view",
                    "type": "function"
                },
                {
                    "inputs": [
                        {
                            "internalType": "address",
                            "name": "",
                            "type": "address"
                        }
                    ],
                    "name": "voters",
                    "outputs": [
                        {
                            "internalType": "uint256",
                            "name": "weight",
                            "type": "uint256"
                        },
                        {
                            "internalType": "bool",
                            "name": "voted",
                            "type": "bool"
                        },
                        {
                            "internalType": "address",
                            "name": "delegate",
                            "type": "address"
                        },
                        {
                            "internalType": "uint256",
                            "name": "vote",
                            "type": "uint256"
                        }
                    ],
                    "stateMutability": "view",
                    "type": "function"
                },
                {
                    "inputs": [],
                    "name": "winnerName",
                    "outputs": [
                        {
                            "internalType": "string",
                            "name": "winnerName_",
                            "type": "string"
                        }
                    ],
                    "stateMutability": "view",
                    "type": "function"
                },
                {
                    "inputs": [],
                    "name": "winningProposal",
                    "outputs": [
                        {
                            "internalType": "uint256",
                            "name": "winningProposal_",
                            "type": "uint256"
                        }
                    ],
                    "stateMutability": "view",
                    "type": "function"
                }
            ]
            const provider = new ethers.providers.Web3Provider(web3.currentProvider);
            contract = new ethers.Contract("0x1B74c9aBCD4f51de1Bc30Adb909BaF15BBb5FAb3", abi, provider);

            //document.getElementById("metamask").innerHTML = "result workin";

            var proposal0 = contract.proposals(0);
            proposal0.then(function (result) {
                document.getElementById("proposal0name").innerHTML = result[0];
                document.getElementById("vote0count").innerHTML = result[1];
            });
            var proposal1 = contract.proposals(1);
            proposal1.then(function (result) {
                document.getElementById("proposal1name").innerHTML = result[0];
                document.getElementById("vote1count").innerHTML = result[1];
            });
            var proposal2 = contract.proposals(2);
            proposal2.then(function (result) {
                document.getElementById("proposal2name").innerHTML = result[0];
                document.getElementById("vote2count").innerHTML = result[1];
            });
        }
        function vote() {            
            abi = [
                {
                    "inputs": [
                        {
                            "internalType": "address",
                            "name": "to",
                            "type": "address"
                        }
                    ],
                    "name": "delegate",
                    "outputs": [],
                    "stateMutability": "nonpayable",
                    "type": "function"
                },
                {
                    "inputs": [
                        {
                            "internalType": "address",
                            "name": "voter",
                            "type": "address"
                        }
                    ],
                    "name": "giveRightToVote",
                    "outputs": [],
                    "stateMutability": "nonpayable",
                    "type": "function"
                },
                {
                    "inputs": [],
                    "stateMutability": "nonpayable",
                    "type": "constructor"
                },
                {
                    "inputs": [
                        {
                            "internalType": "uint256",
                            "name": "proposal",
                            "type": "uint256"
                        }
                    ],
                    "name": "vote",
                    "outputs": [],
                    "stateMutability": "nonpayable",
                    "type": "function"
                },
                {
                    "inputs": [],
                    "name": "chairperson",
                    "outputs": [
                        {
                            "internalType": "address",
                            "name": "",
                            "type": "address"
                        }
                    ],
                    "stateMutability": "view",
                    "type": "function"
                },
                {
                    "inputs": [
                        {
                            "internalType": "uint256",
                            "name": "",
                            "type": "uint256"
                        }
                    ],
                    "name": "proposals",
                    "outputs": [
                        {
                            "internalType": "string",
                            "name": "name",
                            "type": "string"
                        },
                        {
                            "internalType": "uint256",
                            "name": "voteCount",
                            "type": "uint256"
                        }
                    ],
                    "stateMutability": "view",
                    "type": "function"
                },
                {
                    "inputs": [
                        {
                            "internalType": "address",
                            "name": "",
                            "type": "address"
                        }
                    ],
                    "name": "voters",
                    "outputs": [
                        {
                            "internalType": "uint256",
                            "name": "weight",
                            "type": "uint256"
                        },
                        {
                            "internalType": "bool",
                            "name": "voted",
                            "type": "bool"
                        },
                        {
                            "internalType": "address",
                            "name": "delegate",
                            "type": "address"
                        },
                        {
                            "internalType": "uint256",
                            "name": "vote",
                            "type": "uint256"
                        }
                    ],
                    "stateMutability": "view",
                    "type": "function"
                },
                {
                    "inputs": [],
                    "name": "winnerName",
                    "outputs": [
                        {
                            "internalType": "string",
                            "name": "winnerName_",
                            "type": "string"
                        }
                    ],
                    "stateMutability": "view",
                    "type": "function"
                },
                {
                    "inputs": [],
                    "name": "winningProposal",
                    "outputs": [
                        {
                            "internalType": "uint256",
                            "name": "winningProposal_",
                            "type": "uint256"
                        }
                    ],
                    "stateMutability": "view",
                    "type": "function"
                }
            ]
            const provider = new ethers.providers.Web3Provider(web3.currentProvider);
            signer = provider.getSigner(0);
            contract = new ethers.Contract("0x1B74c9aBCD4f51de1Bc30Adb909BaF15BBb5FAb3", abi, signer);

            var proposalval = document.getElementById("ProposalSelect").value;
            var castvote = contract.vote(proposalval);
            castvote.then(function (transaction) {
                document.getElementById("metamask").innerHTML = transaction;
            });
        }
        function delegate() {
            abi = [
                {
                    "inputs": [
                        {
                            "internalType": "address",
                            "name": "to",
                            "type": "address"
                        }
                    ],
                    "name": "delegate",
                    "outputs": [],
                    "stateMutability": "nonpayable",
                    "type": "function"
                },
                {
                    "inputs": [
                        {
                            "internalType": "address",
                            "name": "voter",
                            "type": "address"
                        }
                    ],
                    "name": "giveRightToVote",
                    "outputs": [],
                    "stateMutability": "nonpayable",
                    "type": "function"
                },
                {
                    "inputs": [],
                    "stateMutability": "nonpayable",
                    "type": "constructor"
                },
                {
                    "inputs": [
                        {
                            "internalType": "uint256",
                            "name": "proposal",
                            "type": "uint256"
                        }
                    ],
                    "name": "vote",
                    "outputs": [],
                    "stateMutability": "nonpayable",
                    "type": "function"
                },
                {
                    "inputs": [],
                    "name": "chairperson",
                    "outputs": [
                        {
                            "internalType": "address",
                            "name": "",
                            "type": "address"
                        }
                    ],
                    "stateMutability": "view",
                    "type": "function"
                },
                {
                    "inputs": [
                        {
                            "internalType": "uint256",
                            "name": "",
                            "type": "uint256"
                        }
                    ],
                    "name": "proposals",
                    "outputs": [
                        {
                            "internalType": "string",
                            "name": "name",
                            "type": "string"
                        },
                        {
                            "internalType": "uint256",
                            "name": "voteCount",
                            "type": "uint256"
                        }
                    ],
                    "stateMutability": "view",
                    "type": "function"
                },
                {
                    "inputs": [
                        {
                            "internalType": "address",
                            "name": "",
                            "type": "address"
                        }
                    ],
                    "name": "voters",
                    "outputs": [
                        {
                            "internalType": "uint256",
                            "name": "weight",
                            "type": "uint256"
                        },
                        {
                            "internalType": "bool",
                            "name": "voted",
                            "type": "bool"
                        },
                        {
                            "internalType": "address",
                            "name": "delegate",
                            "type": "address"
                        },
                        {
                            "internalType": "uint256",
                            "name": "vote",
                            "type": "uint256"
                        }
                    ],
                    "stateMutability": "view",
                    "type": "function"
                },
                {
                    "inputs": [],
                    "name": "winnerName",
                    "outputs": [
                        {
                            "internalType": "string",
                            "name": "winnerName_",
                            "type": "string"
                        }
                    ],
                    "stateMutability": "view",
                    "type": "function"
                },
                {
                    "inputs": [],
                    "name": "winningProposal",
                    "outputs": [
                        {
                            "internalType": "uint256",
                            "name": "winningProposal_",
                            "type": "uint256"
                        }
                    ],
                    "stateMutability": "view",
                    "type": "function"
                }
            ]
            const provider = new ethers.providers.Web3Provider(web3.currentProvider);
            signer = provider.getSigner(0);
            contract = new ethers.Contract("0x1B74c9aBCD4f51de1Bc30Adb909BaF15BBb5FAb3", abi, signer);

            var addressval = document.getElementById("txtaddress").value;
            var delegatevote = contract.vote(addressval);
            delegatevote.then(function (transaction) {
                document.getElementById("metamask").innerHTML = transaction;
            });
        }
    </script>
    <div id="metamask"> </div>
    <h1>Blockchain Voting</h1>
    <div class="table.responsive">
        <table class="table table-bordered">
            <thead>
                <tr>
                    <th>Candidate</th>
                    <th>votes</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td id="proposal0name"></td>
                    <td id="vote0count"></td>
                </tr>
                <tr>
                    <td id="proposal1name"></td>
                    <td id="vote1count"></td>
                </tr>
                <tr>
                    <td id="proposal2name"></td>
                    <td id="vote2count"></td>
                </tr>
            </tbody>
        </table>
    </div>
    <select id="ProposalSelect">
        <option value="-1">--select a candidate--</option>
        <option value="0">Joshua Thee King</option>
        <option value="1">Milan Alehandro</option>
        <option value="2">Soledad of Westi</option>
    </select>
    <input id="button1" type="button" onclick="vote()" class="btn btn-info" value="Vote" />
    <h5>Or Delegate Someone to Vote for you</h5>
    <input id="txtaddress" type="text" />
    <input id="button2" type="button" onclick="delegate()" class="btn btn-info" value="Delegate" />
</body>
</html>